# 1-2 相关说明

## 0x00 指纹信息

### 指纹类别

目前平台收录两类指纹，web指纹和service指纹

* web: 基于HTTP/HTTPS构建的站点/应用, 例如dedecms, wordpress ...
* service: 部署于服务器之上的中间件, 数据库等服务组件， 例如 redis，mysql ...

### 指纹名称

web站点/系统中间件服务的名字，例如 redis，kafka，mysql ...

### 版本

web/service 对应的版本信息 可填写4种形式

* 所有版本     :   所有版本都适用这个指纹， 固定填写 "0"
* 单一版本     :   单个指定版本，例如 "6.5.1"
* 范围版本     :   某几个版本或者一定范围内的版本, 例如 "3.2.7-5.6.12"
* 未知版本     :  【默认项】固定填写 ""  

### 描述

web/service的简要介绍信息, 例如:Redis是一个使用ANSI C编写的开源、支持网络、基于内存、分布式、可选持久性的键值对存储数据库.

## 0x01 指纹规则

## service指纹部分

### 传输协议

网络模型传输层使用的协议, TCP 或者 UDP,  默认TCP

### 安全传输选项

是否启用SSL, 默认不启用(False)

### 常用端口

service的常用端口， 例如redis默认端口6379， mysql默认端口3306

* service存在默认端口，则填写默认端口
* service不存在默认端口，则填写常用的端口

### 载荷

发给service的消息(payload), 例如 发给redis的用于获取版本信息的载荷: `"*1\\r\\n$4\\r\\ninfo\\r\\n"`， 默认空字符串 `""`

## web指纹部分

### 识别方式

如何识别web/service中的特征值/模式

* 内容匹配 : 查看 web的源码或service的响应数据中，是否包含关键特征
* 首部匹配 : 查看 web的响应头信息内，是否包含关键特征
* 散列值匹配 : 把响应的数据进行散列算法编码，看是否匹配， 常用于静态文件(图片, logo...)的特征匹配

### 请求路径

请求web站点URL的路径, 例如 "/", "/index.html", "/path/to/xxx.png" ...

### 请求方法

对web站点发起请求时的方法, 例如 GET, POST，HEAD ...

### 请求首部

对web站点发起请求时, 可能需要添加的header信息,例如 `{"Auth":"xu18iuasdh", "cookie": "xxx"}`

### 请求数据

提交给web站点的数据

### 响应状态码

web站点的响应状态码, 例如 200(表示请求ok，正常响应)   0(表示不关注状态码)

## 指纹通用部分

### 匹配规则 [特征模式 和 识别信息]

接收到web/service的响应消息后，进行特征匹配时的规则信息 以及 匹配成功后的识别出的信息.

用一个具体的例子来说明, 以redis为例, 写一个匹配规则. 其中

* 特征模式 = `"^\\$\\d+\\r\\n(?:#[^\\r\\n]*\\r\\n)*redis_version:([.\\d]+)\\r\\n"`
* 识别信息 = `"p/Redis KV-Store/ v/$1/"`

可以看到特征模式支持正则表达式和分组，识别信息中的 `$1` 正好对应 特征模式中的第一个分组.  (`$2`, `$3` 分别对应 第二，第三个分组, 以此类推)

在识别信息中， 有额外的说明字符 `p(product)` 和 `v(version)`,  其中`p`提供更加精确的 web/service 名称， `v`则表示可能的版本信息.

上面的示例中, 

* `p/Redis KV-Store/` 表示如果特征模式匹配成功, 那么service的名称就是 `Redis KV-Store`, 如果没有填写`p`, 则使用指纹信息中的名称
* `v/$1/` 表示如果特征模式匹配成功，那么service的版本就从特征模式的正则表达式的第一个分组提取, 如果没有填写`v`, 则使用指纹信息中的版本

> 更多信息请查看后文 "0x06 匹配规则" 中的说明


## 0x02 环境信息

### 系统名称

提取指纹时，web/service所在的环境 操作系统名称， 例如 "linux"

### 系统版本

提取指纹时，web/service所在的环境 操作系统的版本， 例如 "5.15.0"


## 0x03 产品信息

### 官网

产品的官方网站，例如: "https://redis.io/"

### 分类

产品的分类， 例如 缓存中间件

### 是否开源

是否开放源代码

### 是否信创

是否为信创(信息技术应用创新产业)

### 是否关基

是否为关基（关键信息基础设施）

### 开发语言

开发产品所使用的编程语言，例如: C

### 应用行业

产品在哪些行业被使用，例如：金融行业


## 0x04 指纹验证

### 验证方式

验证指纹正确性/准确率的方式

* 测试URL: 用于测试指纹准确性的URL站点.审核人员使用提交的指纹信息, 对该站点进行测试。多个url使用 `,` 分隔.
* 容器构建及测试: 用户把构建镜像的`Dockerfile`, 启动容器的`Docker-Compose.yml` 以及 相应的测试执行脚本 打包提交. 审核人员以此启动容器验证指纹.
* 指纹视频: 用户拍摄的 或者 上传到某视频站点的URL. 审核人员对视频内容中的指纹提取和测试进行审核.


## 0x05 厂商信息

### 厂商名称

厂商/公司的名称, 例如: "螣龙科技有限公司"

### 描述

公司的简要介绍, 例如: "上海螣龙科技有限公司是一家面向政府和企业的信息安全服务提供商, 以专业的技术和优质的服务为不同领域客户群体提供信息安全旗舰产品"

### 域名

公司域名，例如: "talentsec.cn"

### ICP

ICP备案号, 例如: "沪ICP备20019790号-1"

### 国家

公司所在国家, 例如: "中国"

### 统一社会信用码

统一社会信用码, 例如: "91310112MA1GD12K34"

### 关联母公司

企业关联的母公司名称

### 关联子公司

企业关联的子公司名称


---

## 0x06 匹配规则

## 特征模式及识别信息

特征模式 可以填写 特征字符串 或者 正则表达式， 正则表达式中的分组 可用于识别信息中。

    特征模式 必须要填写. 
    识别信息可以为空(此时名称会使用指纹提交时的产品名称)，也可以在某些特征模式匹配的时候，填入更加完整的信息，或利用正则的分组编号。

识别信息中，可以填写 `product` 和 `version`.

* product 主要用来填写产品名称  格式为 `p/<product-name>/`
* version 主要用来填写版本  格式为 `v/<version>/`

> 如果 pruduct 或者 version 中包含 `/`,  可以选用不在其中的字符作为边界符号  比如 `p|<product-name>|`, `p=<product-name>=` ...


例子1:

```js
[名称] =  "redis"
[特征模式] =  "-NOAUTH Authentication required"
[识别信息] = ""
```

例子2:

```js
[特征模式] = "-ERR wrong number of arguments"
[识别信息] = "p/Redis k-v store/"
```

例子3:

```js
[特征模式] = "^\$\d+\r\n(?:#[^\r\n]*\r\n)*redis_version:([.\d]+)\r\n"
// 这时候正则表达式的分组1 ([.\d]+) 就可以通过 `$1` 在识别信息中引用
[识别信息] = "p/Redis Key-Value Store/ v/$1/"
```

例子4:

```js
[名称] = "http"

[特征模式1] = "^HTTP/1.0 500\\r\\nContent-type: text/plain\\r\\n\\r\\nNo Scan Capable Devices Found\\r\\n"
[识别信息1] = "p/HP Embedded Web Server remote scan service/"

[特征模式2] = "^HTTP/1\\.[01] 200 OK\\r\\nServer: Motion/([\\d.]+)\\r\\n"
[识别信息2] = "p/Motion Camera httpd/ v/$1/"
```

例子5:

```js
[名称] = "avg"

[特征模式] = "^220-AVG7 Anti-Virus daemon mode scanner\\r\\n220-Program version ([\\d.]+), engine (\\d+)\\r\\n220-Virus Database: Version ([\\d/.]+) [-\\d]+\\r\\n"
[识别信息] = "p/AVG daemon mode/ v/$1 engine $2/"
```
